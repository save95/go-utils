package otputil

import (
	"testing"
	"time"

	"github.com/stretchr/testify/assert"
)

func TestGoogleAuth_GetQRCode(t *testing.T) {
	issuer := "OTP Test"
	account := "test@domain.com"
	secret := NewGoogleAuth().GenSecret(16)
	url := NewGoogleAuth().GetQRCodeContent(issuer, account, secret)
	t.Log(url)
}

func TestGoogleAuth_VerifyAt(t *testing.T) {
	maps := map[int64]string{
		1464624399: "454187",
		1464624400: "454187",
		1464624401: "454187",
		1464624402: "454187",
		1464624403: "454187",
		1464624404: "454187",
		1464624405: "454187",
		1464624406: "454187",
		1464624407: "454187",
		1464624408: "454187",
		1464624409: "454187",
		1464624410: "454187",
		1464624411: "454187",
		1464624412: "454187",
		1464624413: "454187",
		1464624414: "454187",
		1464624415: "454187",
		1464624416: "454187",
		1464624417: "454187",
		1464624418: "454187",
		1464624419: "454187",
		1464624420: "794924",
		1464624421: "794924",
		1464624422: "794924",
		1464624423: "794924",
		1464624424: "794924",
		1464624425: "794924",
		1464624426: "794924",
		1464624427: "794924",
		1464624428: "794924",
		1464624429: "794924",
		1464624430: "794924",
		1464624431: "794924",
		1464624432: "794924",
		1464624433: "794924",
		1464624434: "794924",
		1464624435: "794924",
		1464624436: "794924",
		1464624437: "794924",
		1464624438: "794924",
		1464624439: "794924",
		1464624440: "794924",
		1464624441: "794924",
		1464624442: "794924",
		1464624443: "794924",
		1464624444: "794924",
		1464624445: "794924",
		1464624446: "794924",
		1464624447: "794924",
		1464624448: "794924",
		1464624449: "794924",
		1464624450: "735609",
		1464624451: "735609",
		1464624452: "735609",
		1464624453: "735609",
		1464624454: "735609",
		1464624455: "735609",
		1464624456: "735609",
		1464624457: "735609",
		1464624458: "735609",
		1464624459: "735609",
		1464624460: "735609",
		1464624461: "735609",
		1464624462: "735609",
		1464624463: "735609",
		1464624464: "735609",
		1464624465: "735609",
		1464624466: "735609",
		1464624467: "735609",
		1464624468: "735609",
		1464624469: "735609",
		1464624470: "735609",
		1464624471: "735609",
		1464624472: "735609",
		1464624473: "735609",
		1464624474: "735609",
		1464624475: "735609",
		1464624476: "735609",
		1464624477: "735609",
		1464624478: "735609",
		1464624479: "735609",
		1464624480: "161703",
		1464624481: "161703",
		1464624482: "161703",
		1464624483: "161703",
		1464624484: "161703",
		1464624485: "161703",
		1464624486: "161703",
		1464624487: "161703",
		1464624488: "161703",
		1464624489: "161703",
		1464624490: "161703",
		1464624491: "161703",
		1464624492: "161703",
		1464624493: "161703",
		1464624494: "161703",
		1464624495: "161703",
		1464624496: "161703",
		1464624497: "161703",
		1464624498: "161703",
		1464624499: "161703",
		1464624500: "161703",
		1464624501: "161703",
		1464624502: "161703",
		1464624503: "161703",
		1464624504: "161703",
		1464624505: "161703",
		1464624506: "161703",
		1464624507: "161703",
		1464624508: "161703",
		1464624509: "161703",
		1464624510: "482945",
		1464624511: "482945",
		1464624512: "482945",
		1464624513: "482945",
		1464624514: "482945",
		1464624515: "482945",
		1464624516: "482945",
		1464624517: "482945",
		1464624518: "482945",
		1464624519: "482945",
		1464624520: "482945",
		1464624521: "482945",
		1464624522: "482945",
		1464624523: "482945",
		1464624524: "482945",
		1464624525: "482945",
		1464624526: "482945",
	}

	secret := "otp test"
	for timestamp, code := range maps {
		c := NewGoogleAuth().GetCodeAt(secret, time.Unix(timestamp, 0))
		assert.Equal(t, c, code)
	}
}

func TestGoogleAuth_VerifyAt2(t *testing.T) {
	//secret := "JBSWY3DPEHPK3PXP"
	secret := "XIEAJJC6S7IFZSABQ57FAF27P4"
	t.Log(NewGoogleAuth().GetCode(secret))
	a := NewGoogleAuth().VerifyAt(secret, "597062", time.Now())
	t.Log(a)
}
